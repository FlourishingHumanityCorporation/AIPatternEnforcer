#!/bin/bash

# ProjectTemplate pre-commit hook
# Prevents committing files with problematic naming patterns

echo "üîç Running ProjectTemplate compliance checks..."

# 1. Check for improved/enhanced/v2 files
IMPROVED_FILES=$(git diff --cached --name-only | grep -E "_improved\.|_enhanced\.|_v2\.|_better\.|_new\." || true)
if [ -n "$IMPROVED_FILES" ]; then
    echo "‚ùå Found files with prohibited naming patterns:"
    echo "$IMPROVED_FILES" | sed 's/^/   - /'
    echo ""
    echo "üí° Please edit the original files instead of creating new versions."
    echo "   For example: edit 'Login.jsx' instead of creating 'Login_improved.jsx'"
    echo ""
    echo "To bypass this check (not recommended): git commit --no-verify"
    exit 1
fi

# 2. Check for console.log statements in JS/TS files
CONSOLE_LOGS=$(git diff --cached --name-only --diff-filter=ACM | grep -E "\.(js|jsx|ts|tsx)$" | xargs grep -l "console\.log" 2>/dev/null || true)
if [ -n "$CONSOLE_LOGS" ]; then
    echo "‚ö†Ô∏è  Warning: Found console.log statements in:"
    echo "$CONSOLE_LOGS" | sed 's/^/   - /'
    echo ""
    echo "üí° Consider using proper logging with: logging.getLogger(__name__)"
fi

# 3. Check for TODO comments without TodoWrite
NEW_TODOS=$(git diff --cached -U0 | grep -E "^\+.*TODO" | grep -v "TodoWrite" || true)
if [ -n "$NEW_TODOS" ]; then
    echo "‚ÑπÔ∏è  Info: Found TODO comments. Consider using TodoWrite for task tracking."
fi

# 4. Check for files in root directory that shouldn't be there
echo "üóÇÔ∏è  Checking root directory..."
if ! npm run check:root:quiet; then
    echo ""
    echo "‚ùå Found files in root directory that violate project standards."
    echo "   Run 'npm run check:root' for details."
    echo ""
    echo "To bypass this check (not recommended): git commit --no-verify"
    exit 1
fi

# 5. Check for banned document types (summaries, reports, completion docs)
echo "üìÑ Checking for banned document types..."
if ! npm run check:banned-docs:quiet; then
    echo ""
    echo "‚ùå Found banned document types (SUMMARY, REPORT, COMPLETE)."
    echo "   These violate CLAUDE.md documentation standards."
    echo "   Run 'npm run check:banned-docs' for details."
    echo ""
    echo "To bypass this check (not recommended): git commit --no-verify"
    exit 1
fi

echo "‚úÖ Pre-commit checks completed"